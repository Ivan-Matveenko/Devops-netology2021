 -- Домашнее задание к занятию "6.6. Troubleshooting"--



Задание 1 
Определим текущую операцию командой:  
       db.currentOp()
Завершим операцию по opid
       db.killOp()

Задание 2
Предполагаю, что проблема связана с исчерпанием ресурсов оперативной памяти.

Задание 3
Предполагаю что ошибки начали возникать из-за роста нагрузки. 
В качестве решения можно предложить:
   1. Увеличить значение параметров : connect_timeout, interactive_timeout, wait_timeout
   2. Добавить ресурсов на машине
   3. Создать индексы для оптимизации  и ускорения запросов (определить по плану запрос

Задание 4

Причина в недостатке ресурсов оперативной памяти, в результате ОС завершает процессы утилизирующие память, чтобы предотвратить падение всей системы.
Для предотвращения сбоев , необходимо увеличить объем ОЗУ или выставить ограничение в настройках PG на использование ресурсов хоста, 
чтобы исключить потребление всех ресурсов на машине.
--------------------
Доработка 

КАк я понял - это механизм резервирования памяти сервера , но в нужный момент свободной памяти нет, и происходит сбой системы. OOM играет важную роль в этом сценарии и завершает процессы, чтобы уберечь ядро от паники.
В данном случае киллер будет спасителем системы. Он «убивает» самые нехорошие процессы и спасает систему от аварийного завершения. Чтобы не приходилось использовать OOM-Killer для завершения PostgreSQL, установите для vm.overcommit_memory значение 2. Это не гарантирует, что OOM-Killer не придется вмешиваться, но снизит вероятность принудительного завершения процесса PostgreSQL.

Чтобы уреголировать это
я бы сделал рекомендацию из статьи habr - https://habr.com/ru/company/southbridge/blog/464245/
а именно  воспользовался бы рекомендацией из статьи - раздел "Как контролировать OOM-Killer"
  



